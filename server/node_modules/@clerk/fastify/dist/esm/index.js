var T=Object.create;var k=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var H=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var N=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of O(t))!I.call(e,n)&&n!==o&&k(e,n,{get:()=>t[n],enumerable:!(r=b(t,n))||r.enumerable});return e};var U=(e,t,o)=>(o=e!=null?T(L(e)):{},N(t||!e||!e.__esModule?k(o,"default",{value:e,enumerable:!0}):o,e));var R=H(y=>{"use strict";y.parse=D;y.serialize=M;var Y=Object.prototype.toString,u=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function D(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var o={},r=t||{},n=r.decode||j,s=0;s<e.length;){var i=e.indexOf("=",s);if(i===-1)break;var a=e.indexOf(";",s);if(a===-1)a=e.length;else if(a<i){s=e.lastIndexOf(";",i-1)+1;continue}var p=e.slice(s,i).trim();if(o[p]===void 0){var f=e.slice(i+1,a).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1)),o[p]=W(f,n)}s=a+1}return o}function M(e,t,o){var r=o||{},n=r.encode||B;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!u.test(e))throw new TypeError("argument name is invalid");var s=n(t);if(s&&!u.test(s))throw new TypeError("argument val is invalid");var i=e+"="+s;if(r.maxAge!=null){var a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!u.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!u.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){var p=r.expires;if(!V(p)||isNaN(p.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+p.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority){var f=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(f){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var c=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(c){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function j(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function B(e){return encodeURIComponent(e)}function V(e){return Y.call(e)==="[object Date]"||e instanceof Date}function W(e,t){try{return t(e)}catch{return e}}});import q from"fastify-plugin";var x=U(R());import{Clerk as $}from"@clerk/backend";import{constants as z}from"@clerk/backend";var w=process.env.CLERK_API_URL||"https://api.clerk.dev",C=process.env.CLERK_API_VERSION||"v1",A=process.env.CLERK_API_KEY||"",d=process.env.CLERK_SECRET_KEY||"",m=process.env.CLERK_FRONTEND_API||"",v=process.env.CLERK_PUBLISHABLE_KEY||"",S=process.env.CLERK_JWT_KEY||"",{Cookies:g,Headers:l}=z;var _=$,h=_({secretKey:d,apiUrl:w,apiVersion:C,jwtKey:S});var E=e=>(Array.isArray(e)?e[0]:e)||void 0;var P=e=>async(t,o)=>{let r=(0,x.parse)(t.raw.headers.cookie||""),n=e.secretKey||d,s=e.publishableKey||v,i=r[g.Session],a=t.headers.authorization?.replace("Bearer ",""),p=E(t.headers["x-forwarded-port"]),f=E(t.headers["x-forwarded-host"]),c=await h.authenticateRequest({...e,secretKey:n,publishableKey:s,apiKey:A,frontendApi:m,cookieToken:i,headerToken:a,clientUat:r[g.ClientUat],origin:t.headers.origin||void 0,host:t.headers.host,forwardedPort:p,forwardedHost:f,referrer:t.headers.referer||void 0,userAgent:t.headers["user-agent"]||void 0});if(c.isUnknown)return o.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).send();if(c.isInterstitial){let K=h.localInterstitial({publishableKey:s,frontendApi:m});return o.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).type("text/html").send(K)}t.auth=c.toAuth()};var G=(e,t,o)=>{e.decorateRequest("auth",null),e.addHook("preHandler",P(t)),o()},Q=q(G,{name:"@clerk/fastify",fastify:"4.x"});var X=e=>`\u{1F512} Clerk: ${e.trim()}

For more info, check out the docs: https://clerk.com/docs,
or come say hi in our discord server: https://clerk.com/discord
`,F=X(`The "clerkPlugin" should be registered before using the "getAuth".
Example:

import { clerkPlugin } from '@clerk/fastify';

const server: FastifyInstance = Fastify({ logger: true });
server.register(clerkPlugin);
`);var Z=e=>{let t=e;if(!t.auth)throw new Error(F);return t.auth};export{h as clerkClient,Q as clerkPlugin,_ as createClerkClient,Z as getAuth};
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
//# sourceMappingURL=index.js.map
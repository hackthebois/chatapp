"use strict";var U=Object.create;var d=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var B=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),V=(e,t)=>{for(var o in t)d(e,o,{get:t[o],enumerable:!0})},w=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of D(t))!j.call(e,n)&&n!==o&&d(e,n,{get:()=>t[n],enumerable:!(r=Y(t,n))||r.enumerable});return e};var C=(e,t,o)=>(o=e!=null?U(M(e)):{},w(t||!e||!e.__esModule?d(o,"default",{value:e,enumerable:!0}):o,e)),W=e=>w(d({},"__esModule",{value:!0}),e);var A=B(m=>{"use strict";m.parse=J;m.serialize=$;var z=Object.prototype.toString,h=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function J(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var o={},r=t||{},n=r.decode||q,s=0;s<e.length;){var i=e.indexOf("=",s);if(i===-1)break;var a=e.indexOf(";",s);if(a===-1)a=e.length;else if(a<i){s=e.lastIndexOf(";",i-1)+1;continue}var p=e.slice(s,i).trim();if(o[p]===void 0){var f=e.slice(i+1,a).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1)),o[p]=X(f,n)}s=a+1}return o}function $(e,t,o){var r=o||{},n=r.encode||G;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!h.test(e))throw new TypeError("argument name is invalid");var s=n(t);if(s&&!h.test(s))throw new TypeError("argument val is invalid");var i=e+"="+s;if(r.maxAge!=null){var a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!h.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!h.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){var p=r.expires;if(!Q(p)||isNaN(p.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+p.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority){var f=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(f){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var c=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(c){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function q(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function G(e){return encodeURIComponent(e)}function Q(e){return z.call(e)==="[object Date]"||e instanceof Date}function X(e,t){try{return t(e)}catch{return e}}});var re={};V(re,{clerkClient:()=>u,clerkPlugin:()=>L,createClerkClient:()=>k,getAuth:()=>H});module.exports=W(re);var O=C(require("fastify-plugin"));var T=C(A());var K=require("@clerk/backend");var v=require("@clerk/backend"),S=process.env.CLERK_API_URL||"https://api.clerk.dev",_=process.env.CLERK_API_VERSION||"v1",x=process.env.CLERK_API_KEY||"",y=process.env.CLERK_SECRET_KEY||"",g=process.env.CLERK_FRONTEND_API||"",P=process.env.CLERK_PUBLISHABLE_KEY||"",F=process.env.CLERK_JWT_KEY||"",{Cookies:E,Headers:l}=v.constants;var k=K.Clerk,u=k({secretKey:y,apiUrl:S,apiVersion:_,jwtKey:F});var R=e=>(Array.isArray(e)?e[0]:e)||void 0;var b=e=>async(t,o)=>{let r=(0,T.parse)(t.raw.headers.cookie||""),n=e.secretKey||y,s=e.publishableKey||P,i=r[E.Session],a=t.headers.authorization?.replace("Bearer ",""),p=R(t.headers["x-forwarded-port"]),f=R(t.headers["x-forwarded-host"]),c=await u.authenticateRequest({...e,secretKey:n,publishableKey:s,apiKey:x,frontendApi:g,cookieToken:i,headerToken:a,clientUat:r[E.ClientUat],origin:t.headers.origin||void 0,host:t.headers.host,forwardedPort:p,forwardedHost:f,referrer:t.headers.referer||void 0,userAgent:t.headers["user-agent"]||void 0});if(c.isUnknown)return o.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).send();if(c.isInterstitial){let N=u.localInterstitial({publishableKey:s,frontendApi:g});return o.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).type("text/html").send(N)}t.auth=c.toAuth()};var ee=(e,t,o)=>{e.decorateRequest("auth",null),e.addHook("preHandler",b(t)),o()},L=(0,O.default)(ee,{name:"@clerk/fastify",fastify:"4.x"});var te=e=>`\u{1F512} Clerk: ${e.trim()}

For more info, check out the docs: https://clerk.com/docs,
or come say hi in our discord server: https://clerk.com/discord
`,I=te(`The "clerkPlugin" should be registered before using the "getAuth".
Example:

import { clerkPlugin } from '@clerk/fastify';

const server: FastifyInstance = Fastify({ logger: true });
server.register(clerkPlugin);
`);var H=e=>{let t=e;if(!t.auth)throw new Error(I);return t.auth};0&&(module.exports={clerkClient,clerkPlugin,createClerkClient,getAuth});
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
//# sourceMappingURL=index.js.map